import time
import os
import numpy as np
import ctypes

from collections import Counter
from pyscf import lib, gto
from pyscf.geomopt.geometric_solver import optimize
from gpu4pyscf import dft
# from mpi4pyscf import dft

from Compound_Properties import get_spin
from External_Saving import save_opt_xyz, save_opt_csv

_loaderpath = 'libdftd3-master/lib'
libdftd3 = np.ctypeslib.load_library('libdftd3.so', _loaderpath)

init_guess = ['hcore', 'minao', 'atom']

bases = ['6-31G', 'STO-6G', 'def2-svp', 'aug-cc-pVDZ']
density_fit_bases = ['weigend', 'def2-svp']

wrapper_xe_funcs = ['b3-lyp', 'pbe', 'b97-d', 'SVWN', 'b-lyp']
select_wrap_xe = 1


def dftd3_wrapper(mf, mol):
    """
        Takes a setup molecule system and calculates total energy whilst taking into account
        attractive and repulsive forces.

        :param mf: Mean-field object.
        :param mol: Molecule system.
        :return: System energy and forces.
    """

    coords = mol.atom_coords()
    itype = np.zeros(mol.natm, dtype=np.int32)
    for ia in range(mol.natm):
        symb = mol.atom_pure_symbol(ia)
        itype[ia] = lib.parameters.NUC[symb]

    func = wrapper_xe_funcs[select_wrap_xe].encode()

    version = 4
    tz = 0
    edisp = np.zeros(1)
    grad = np.zeros((mol.natm, 3))

    libdftd3.wrapper(
        ctypes.c_int(mol.natm),
        coords.ctypes.data_as(ctypes.c_void_p),
        itype.ctypes.data_as(ctypes.c_void_p),
        ctypes.c_char_p(func),
        ctypes.c_int(version),
        ctypes.c_int(tz),
        edisp.ctypes.data_as(ctypes.c_void_p),
        grad.ctypes.data_as(ctypes.c_void_p),
    )                                                                                                                   # Call the libdftd3 wrapper.

    energy_with_dispersion = (mf.kernel() + edisp[0]) * 27.2114                                                         # Add dispersion correction to the SCF energy (in eV).

    forces = -grad * 27.2114                                                                                            # Convert to eV/Angstrom.

    return energy_with_dispersion, forces


def calculate_energy(atoms):
    """
        Takes in the XYZ format of the 3D coordinates of the material and computes
        the total energy.

        :param atoms: 3D coordinates of a material.
        :return: The total energy in eV.
    """

    symbols = [line.split()[0] for line in atoms]
    element_count = [(atom, str(count)) for atom, count in Counter(symbols).items()]

    mol = gto.M(
        verbose=5,
        atom=atoms,
        basis='STO-6G',
        unit='Angstrom',
        spin=get_spin(element_count)
    )                                                                                                                   # Define the molecule in PySCF.

    start_time = time.time()

    mf = dft.RKS(mol).density_fit(auxbasis='def2-svp')
    mf.conv_tol = 1e-4
    mf.level_shift = 0.5

    mf.xc = 'pbe'
    mf.init_guess = 'atom'
    mf.disp = 'd3bj'

    mf.direct_scf = True
    mf.diis = True
    mf.with_df._cderi_to_disk = True# Use DIIS for SCF convergence acceleration.                                                                                           # Use the 'dftd3' engine.

    # corrected_energy, _ = dftd3_wrapper(mf, mol)                                                                           # Call the dftd3 function.

    corrected_energy = mf.kernel() * 27.2114

    end_time = time.time()

    print("Total time taken for energy calculation: ", end_time - start_time)

    return corrected_energy


def optimise_geometry(atoms, num_fixed, name):
    """
    Perform the geometry optimization with rigid body constraints for the first `num_fixed` atoms.
    """

    symbols = [line.split()[0] for line in atoms]
    element_count = [(atom, str(count)) for atom, count in Counter(symbols).items()]

    mol = gto.M(
        verbose=5,
        atom=atoms,
        basis='STO-6G',
        unit='Angstrom',
        spin=get_spin(element_count)
    )

    mf = dft.RKS(mol).density_fit(auxbasis='def2-svp')

    mf.direct_scf = True
    mf.diis = True
    mf.with_df._cderi_to_disk = True

    mf.xc = 'pbe'
    mf.init_guess = 'atom'
    mf.disp = 'd3bj'

    mf.grids.level = 4
    mf.level_shift = 0.5
    mf.conv_tol = 1e-4

    def write_constraints(num_fixed, name):
        os.makedirs("Constraints", exist_ok=True)  # Ensure folder exists
        filename = f"Constraints/constraints_{name}.txt"

        with open(filename, "w") as f:
            f.write("$freeze\n")
            # f.write(f"rotation 1-{num_fixed}\n")  # Freezes rotation

            for i in range(1, num_fixed + 1):
                for j in range(i + 1, num_fixed + 1):  # Avoid repeating pairs (i, j) and (j, i)
                    f.write(f"distance {i} {j}\n")

        return filename

    constraint_path = write_constraints(num_fixed, name)

    params = {
        "constraints": constraint_path,
        "convergence_energy": 5e-1,
        "other": ["--conmethod", "1"]
    }

    start_time = time.time()

    opt = optimize(mf, **params)
    optimized_coords = opt.atom_coords()

    end_time = time.time()

    print('Optimisation time: ', end_time - start_time)

    atom_symbols = [atom[0] for atom in opt._atom]

    ANGSTROM_TO_BOHR = 1/1.8897259886
    optimized_coords_bohr = np.array(optimized_coords) * ANGSTROM_TO_BOHR

    optimized_atoms = [
        f"{symbol} {x:.6f} {y:.6f} {z:.6f}"
        for symbol, (x, y, z) in zip(atom_symbols, optimized_coords_bohr)
    ]

    save_opt_csv(optimized_coords_bohr, f'Optimised Coordinates/{name}_optimised_1_csv')
    save_opt_xyz(atom_symbols, optimized_coords_bohr, f"Optimised Coordinates/{name}_optimised_1_coords")

    return optimized_atoms


num_atoms = 63
compound = 'TiO2-A'
# coords_init = ['Ti 0.0000000000 0.0000000000 0.0000000002', 'Ti 0.0000000000 -1.8912698030 2.4037554262', 'Ti 0.0000000000 1.8912698030 2.4037554262', 'Ti -1.8912698030 -1.8912698030 -4.8075108528', 'Ti -1.8912698030 -1.8912698030 4.8075108532', 'Ti -1.8912698030 1.8912698030 -4.8075108528', 'Ti -1.8912698030 1.8912698030 4.8075108532', 'Ti 1.8912698030 -1.8912698030 -4.8075108528', 'Ti 1.8912698030 -1.8912698030 4.8075108532', 'Ti 1.8912698030 1.8912698030 -4.8075108528', 'Ti 1.8912698030 1.8912698030 4.8075108532', 'Ti -1.8912698030 0.0000000000 -2.4037554268', 'Ti 1.8912698030 0.0000000000 -2.4037554268', 'O -1.8912698030 0.0000000000 -0.4119832958', 'O 1.8912698030 0.0000000000 -0.4119832958', 'O 0.0000000000 0.0000000000 1.9917721302', 'O 0.0000000000 -1.8912698030 0.4119832962', 'O 0.0000000000 1.8912698030 0.4119832962', 'O -1.8912698030 -1.8912698030 2.8157387222', 'O -1.8912698030 1.8912698030 2.8157387222', 'O 1.8912698030 -1.8912698030 2.8157387222', 'O 1.8912698030 1.8912698030 2.8157387222', 'O 0.0000000000 -1.8912698030 4.3955275562', 'O 0.0000000000 1.8912698030 4.3955275562', 'O -1.8912698030 -1.8912698030 -2.8157387228', 'O -1.8912698030 1.8912698030 -2.8157387228', 'O 1.8912698030 -1.8912698030 -2.8157387228', 'O 1.8912698030 1.8912698030 -2.8157387228', 'O -1.8912698030 0.0000000000 -4.3955275568', 'O 1.8912698030 0.0000000000 -4.3955275568', 'O 0.0000000000 0.0000000000 -1.9917721298', 'O 0.0000000000 -3.7825396060 1.9917721302', 'O 0.0000000000 3.7825396060 1.9917721302', 'O -3.7825396060 -1.8912698030 -5.2194941488', 'O -1.8912698030 -3.7825396060 -4.3955275568', 'O -1.8912698030 -1.8912698030 -6.7992829828', 'O 0.0000000000 -1.8912698030 -5.2194941488', 'O -3.7825396060 -1.8912698030 4.3955275562', 'O -1.8912698030 -3.7825396060 5.2194941492', 'O -1.8912698030 -1.8912698030 6.7992829832', 'O -1.8912698030 0.0000000000 5.2194941492', 'O -3.7825396060 1.8912698030 -5.2194941488', 'O -1.8912698030 1.8912698030 -6.7992829828', 'O -1.8912698030 3.7825396060 -4.3955275568', 'O 0.0000000000 1.8912698030 -5.2194941488', 'O -3.7825396060 1.8912698030 4.3955275562', 'O -1.8912698030 1.8912698030 6.7992829832', 'O -1.8912698030 3.7825396060 5.2194941492', 'O 1.8912698030 -3.7825396060 -4.3955275568', 'O 1.8912698030 -1.8912698030 -6.7992829828', 'O 3.7825396060 -1.8912698030 -5.2194941488', 'O 1.8912698030 -3.7825396060 5.2194941492', 'O 1.8912698030 -1.8912698030 6.7992829832', 'O 1.8912698030 0.0000000000 5.2194941492', 'O 3.7825396060 -1.8912698030 4.3955275562', 'O 1.8912698030 1.8912698030 -6.7992829828', 'O 1.8912698030 3.7825396060 -4.3955275568', 'O 3.7825396060 1.8912698030 -5.2194941488', 'O 1.8912698030 1.8912698030 6.7992829832', 'O 1.8912698030 3.7825396060 5.2194941492', 'O 3.7825396060 1.8912698030 4.3955275562', 'O -3.7825396060 0.0000000000 -1.9917721298', 'O 3.7825396060 0.0000000000 -1.9917721298', 'H 5.5681512211 4.1988683282 7.4792924343', 'H 5.0613352565 4.5157976937 7.8587095600', 'H -4.6577783137 6.2664137625 -8.0286839600', 'H -4.9747076792 5.7595977977 -8.4081010857', 'H -5.3983413516 -4.5615331409 7.3921803649', 'H -5.2311451260 -4.1531328809 7.9458216294', 'H -5.1307658956 -5.8853323559 -8.1179393365', 'H -4.5017200973 -6.1406792043 -8.3188457092', 'H -5.0613352565 4.5157976937 7.8587095600', 'H -5.5681512211 4.1988683282 7.4792924343', 'H 4.6577783137 6.2664137625 -8.0286839600', 'H 4.9747076792 5.7595977977 -8.4081010857', 'H 4.6718559105 -5.1870698140 -7.5685478111', 'H 4.0428101121 -5.4424166624 -7.7694541839', 'H 5.8853323567 -5.1307658952 8.1179393360', 'H 6.1406792050 -4.5017200968 8.3188457087', 'H -4.8583635517 0.8236588835 -9.5327399344', 'H -5.3136419247 0.4371876519 -9.1524432211', 'H -6.1298642362 -0.4371876519 -9.7736198747', 'H -6.5851426093 -0.8236588835 -9.3933231613', 'H -5.1076371272 6.2230265313 -1.5530389461', 'H -5.5926032636 5.7380603949 -1.3773127582', 'H -6.4451671761 6.2997100448 1.3773127583', 'H -6.9301333125 5.8147439084 1.5530389461', 'H -0.3009980212 7.7825396060 -1.0609247698', 'H -0.9598485141 7.7825396060 -1.3201158731', 'H 0.9598485141 8.7825396060 2.1440824655', 'H 0.3009980212 8.7825396060 1.8848913622', 'H 5.2764246124 6.0542390461 -1.8034862452', 'H 5.4238157785 5.9068478800 -1.1268654590', 'H 6.4451671761 6.2997100448 1.3773127583', 'H 6.9301333125 5.8147439084 1.5530389461', 'H -7.7825396060 -0.3009980212 -1.8848913622', 'H -7.7825396060 -0.9598485141 -2.1440824654', 'H -8.7825396060 0.9598485141 1.3201158728', 'H -8.7825396060 0.3009980212 1.0609247696', 'H -5.7410662053 -5.5895974532 -1.6367911677', 'H -6.2200207209 -5.1106429376 -1.8428715985', 'H -5.8177497188 -6.9271275021 1.8428715983', 'H -6.2967042344 -6.4481729865 1.6367911675', 'H -0.9598485141 -7.7825396060 2.1440824655', 'H -0.3009980212 -7.7825396060 1.8848913622', 'H 0.3009980212 -8.7825396060 -1.0609247698', 'H 0.9598485141 -8.7825396060 -1.3201158731', 'H -6.4659455771 0.8530068119 7.4538368174', 'H -6.1255225414 0.4078397234 7.8865057671', 'H -6.6214267396 -0.4078397234 8.8734366081', 'H -6.2810037040 -0.8530068119 9.3061055579', 'H -0.2764232677 5.7164260059 8.8159953002', 'H -0.9844232677 5.7164260059 8.8159953002', 'H 0.6304232677 5.4553935738 10.3370092020', 'H 0.6304232677 5.9987667363 9.8831263908', 'H 0.2764232677 6.2957340587 -7.6701712931', 'H 0.9844232677 6.2957340587 -7.6701712931', 'H -0.6304232677 6.2323200356 -9.3679812520', 'H -0.6304232677 6.6701104068 -8.8115609155', 'H 7.7825396060 0.3009980212 1.0609247696', 'H 7.7825396060 0.9598485141 1.3201158728', 'H 8.7825396060 -0.9598485141 -2.1440824654', 'H 8.7825396060 -0.3009980212 -1.8848913622', 'H 5.4238157785 -5.9068478800 2.0781417759', 'H 5.2764246123 -6.0542390462 1.4015209898', 'H 6.4481729865 -6.2967042344 -1.6367911677', 'H 6.9271275021 -5.8177497188 -1.8428715985', 'H 5.4887868193 -0.4371876519 -9.0061436564', 'H 5.9440651924 -0.8236588835 -8.6258469431', 'H 5.4553935738 0.6304232677 -10.3370092016', 'H 5.9987667363 0.6304232677 -9.8831263904', 'H -0.6304232677 -0.9844232677 -10.7992829828', 'H -0.6304232677 -0.2764232677 -10.7992829828', 'H 0.2764232677 0.6304232677 -11.7992829828', 'H 0.9844232677 0.6304232677 -11.7992829828', 'H 0.8530068119 -6.4659455766 -7.4538368183', 'H 0.4078397234 -6.1255225409 -7.8865057680', 'H -0.4078397234 -6.6214267391 -8.8734366089', 'H -0.8530068119 -6.2810037033 -9.3061055586', 'H 6.2957340592 -0.9844232677 7.6701712922', 'H 6.2957340592 -0.2764232677 7.6701712922', 'H 6.6701104074 0.6304232677 8.8115609147', 'H 6.2323200363 0.6304232677 9.3679812513', 'H -0.3801074671 -0.3801074671 10.7992829832', 'H -0.8807390682 -0.8807390682 10.7992829832', 'H 0.8807390682 0.8807390682 11.7992829832', 'H 0.3801074671 0.3801074671 11.7992829832', 'H 0.2764232677 -5.7164260059 8.8159953002', 'H 0.9844232677 -5.7164260059 8.8159953002', 'H -0.8236588835 -5.4994409686 10.3002161531', 'H -0.4371876519 -5.9547193416 9.9199194397']
# coords_1 = ['Ti 1.101087 0.630148 -0.110634', 'Ti 1.592973 -1.113016 2.354023', 'Ti 1.363225 2.657729 2.164312', 'Ti -1.402367 -1.638040 -4.452832', 'Ti 0.105593 -1.069237 5.026152', 'Ti -1.632129 2.132643 -4.642561', 'Ti -0.124180 2.701531 4.836435', 'Ti 2.326269 -1.441312 -5.057808', 'Ti 3.834254 -0.872498 4.421175', 'Ti 2.096547 2.329386 -5.247549', 'Ti 3.604522 2.898291 4.231448', 'Ti -1.140236 0.389597 -2.177899', 'Ti 2.588426 0.586338 -2.782882', 'O -0.827855 0.507411 -0.214289', 'O 2.900809 0.704152 -0.819275', 'O 1.413424 0.747973 1.852843', 'O 1.280572 -1.230860 0.390394', 'O 1.050826 2.539918 0.200656', 'O -0.206763 -1.187031 3.062625', 'O -0.436517 2.583740 2.872898', 'O 3.521902 -0.990289 2.457639', 'O 3.292158 2.780486 2.267909', 'O 1.905327 -0.995128 4.317553', 'O 1.675573 2.775660 4.127793', 'O -1.089969 -1.520206 -2.489169', 'O -1.319726 2.250595 -2.678903', 'O 2.638680 -1.323469 -3.094152', 'O 2.408942 2.447335 -3.283889', 'O -1.452596 0.271752 -4.141344', 'O 2.276122 0.468494 -4.746327', 'O 0.788713 0.512238 -2.074199', 'O 1.643204 -3.022800 2.042683', 'O 1.183713 4.518772 1.663215', 'O -3.331303 -1.760758 -4.556428', 'O -1.222859 -3.499053 -3.951733', 'O -1.714739 -1.755865 -6.416353', 'O 0.397341 -1.563862 -5.161479', 'O -1.823330 -1.191936 4.922548', 'O 0.285108 -2.930213 5.527242', 'O 0.417993 -0.951374 6.989804', 'O 0.055495 0.840573 5.337636', 'O -3.561046 2.010023 -4.746162', 'O -1.944496 2.014918 -6.606086', 'O -1.682364 4.042531 -4.331196', 'O 0.167608 2.206871 -5.351162', 'O -2.053076 2.578847 4.732813', 'O 0.188241 2.819424 6.800071', 'O -0.174392 4.611350 5.147777', 'O 2.505784 -3.302318 -4.556714', 'O 2.013920 -1.559132 -7.021338', 'O 4.126019 -1.367290 -5.766398', 'O 4.013775 -2.733470 4.922257', 'O 4.146670 -0.754632 6.384816', 'O 3.784034 1.037307 4.732651', 'O 5.634002 -0.798457 3.712574', 'O 1.784185 2.211656 -7.211076', 'O 2.046305 4.239269 -4.936183', 'O 3.896273 2.403497 -5.956133', 'O 3.916919 3.016174 6.195081', 'O 3.554282 4.808092 4.542788', 'O 5.404249 2.972337 3.522839', 'O -2.939953 0.315569 -1.469229', 'O 4.517374 0.709048 -2.679201', 'H 4.492048 4.123278 6.975256', 'H 5.825902 4.418154 7.443075', 'H -4.438955 6.246775 -7.462324', 'H -5.063270 5.599070 -8.275063', 'H -5.573837 -4.710509 7.303439', 'H -4.725896 -3.854044 7.028650', 'H -5.344152 -5.785413 -7.792090', 'H -4.197782 -6.091115 -7.986704', 'H -4.717456 4.511229 7.549540', 'H -5.668943 4.110258 6.942741', 'H 4.433412 6.138523 -7.420321', 'H 5.112754 5.696453 -8.327730', 'H 4.436185 -5.531643 -7.545754', 'H 3.991230 -4.630841 -6.681757', 'H 5.854038 -5.419880 7.864469', 'H 6.035157 -4.232585 7.958582', 'H -4.393918 0.991722 -9.348218', 'H -5.411968 0.836798 -8.746002', 'H -5.958054 -0.821540 -9.455090', 'H -7.153349 -1.001501 -9.366361', 'H -4.067285 5.491600 -1.477578', 'H -5.109004 4.951556 -1.312666', 'H -5.735777 6.025556 1.312645', 'H -6.691762 5.326141 1.519674', 'H -0.061706 6.094062 -0.841592', 'H -0.923027 6.798190 -1.261842', 'H 1.154293 8.312660 2.063608', 'H 0.043827 8.069529 1.698530', 'H 4.931121 5.509289 -1.254298', 'H 3.924451 4.597734 -1.511051', 'H 5.975917 6.226022 1.291077', 'H 6.540191 5.178151 1.441930', 'H -7.217228 -0.024116 -1.716653', 'H -7.129612 -1.166166 -2.050104', 'H -8.589555 0.938218 1.286810', 'H -7.592530 0.260161 1.026368', 'H -4.633284 -4.681680 -1.468286', 'H -5.822752 -4.798264 -1.723846', 'H -5.241690 -6.700466 1.800552', 'H -5.986617 -5.805482 1.514741', 'H -1.025231 -6.586436 1.952791', 'H -0.037054 -7.195680 1.727037', 'H 0.316924 -7.418938 -1.032902', 'H 0.896515 -8.490064 -1.251429', 'H -6.436432 0.815222 7.229428', 'H -5.339506 0.578787 6.434134', 'H -6.906571 -0.496321 8.766063', 'H -6.081485 -1.077778 9.410769', 'H -0.457149 6.226296 8.546209', 'H -1.275512 5.428436 8.183527', 'H 0.674306 5.413065 10.637087', 'H 1.047968 6.070873 9.667952', 'H 0.659747 4.590963 -5.949321', 'H 0.703943 6.012318 -6.882260', 'H -0.660853 5.804372 -8.892592', 'H -0.815847 7.034230 -9.021666', 'H 6.266623 0.057474 0.880211', 'H 6.915936 0.990979 1.217170', 'H 8.202231 -1.172104 -2.107299', 'H 8.300701 -0.029165 -1.768090', 'H 4.986854 -5.605239 1.649025', 'H 4.114844 -4.668488 1.486864', 'H 5.763126 -5.999734 -1.502062', 'H 6.676026 -5.284536 -1.802154', 'H 5.204958 -0.631559 -8.521701', 'H 6.288003 -1.041714 -8.169914', 'H 5.196691 0.737533 -10.324239', 'H 6.294359 0.982477 -9.826448', 'H -0.583092 -1.362819 -10.359798', 'H -0.971427 -0.238580 -10.476687', 'H 0.270325 0.983068 -11.471552', 'H 1.313252 0.641365 -11.973837', 'H 0.822962 -6.353086 -7.059648', 'H 0.531643 -4.976680 -6.215292', 'H -0.467580 -6.816311 -8.658972', 'H -1.046009 -6.008869 -9.325182', 'H 5.812225 -0.928629 6.870237', 'H 4.726312 -0.396452 5.374095', 'H 6.954985 0.813060 8.675878', 'H 6.115874 0.655984 9.549675', 'H -0.532534 -0.540473 10.889693', 'H -1.157103 -1.113287 10.115710', 'H 1.115015 1.071331 12.248292', 'H 0.603035 0.571391 11.302473', 'H 0.427621 -6.170708 8.354773', 'H 1.314087 -5.392165 8.167478', 'H -1.036781 -5.489422 10.664136', 'H -0.711367 -5.971673 9.619352']
# coords_2 = ['Ti 1.067018 0.722777 -0.241227', 'Ti 1.623851 -0.987777 2.233565', 'Ti 1.296077 2.777734 2.017706', 'Ti -1.416257 -1.637776 -4.540944', 'Ti 0.159738 -0.962087 4.918857', 'Ti -1.746496 2.124324 -4.759259', 'Ti -0.170355 2.804467 4.700881', 'Ti 2.300086 -1.351961 -5.183643', 'Ti 3.877214 -0.672469 4.278791', 'Ti 1.972974 2.410904 -5.396329', 'Ti 3.548699 3.087527 4.062146', 'Ti -1.187928 0.411312 -2.284854', 'Ti 2.530341 0.698933 -2.924761', 'O -0.861745 0.551772 -0.325727', 'O 2.856886 0.837921 -0.965308', 'O 1.392588 0.863685 1.719945', 'O 1.297073 -1.118796 0.274066', 'O 0.970275 2.632411 0.057519', 'O -0.164983 -1.101611 2.958018', 'O -0.495426 2.663409 2.743396', 'O 3.548742 -0.814089 2.318788', 'O 3.222505 2.949124 2.103716', 'O 1.950088 -0.846618 4.193350', 'O 1.622074 2.917393 3.976683', 'O -1.090199 -1.498240 -2.582025', 'O -1.418814 2.264333 -2.797927', 'O 2.626439 -1.211522 -3.221879', 'O 2.298846 2.551953 -3.438182', 'O -1.513761 0.271261 -4.244517', 'O 2.204105 0.558566 -4.884707', 'O 0.739762 0.583772 -2.199818', 'O 1.719884 -2.897922 1.934459', 'O 1.064851 4.634174 1.506686', 'O -3.342998 -1.810718 -4.628146', 'O -1.185801 -3.490748 -4.030537', 'O -1.743311 -1.777492 -6.502877', 'O 0.374012 -1.523624 -5.267800', 'O -1.767007 -1.132631 4.832524', 'O 0.389652 -2.811675 5.430600', 'O 0.485383 -0.819833 6.877481', 'O 0.062780 0.950252 5.215821', 'O -3.670755 1.951313 -4.843438', 'O -2.071480 1.983378 -6.717727', 'O -1.840903 4.033584 -4.459477', 'O 0.046164 2.238287 -5.483825', 'O -2.094185 2.629872 4.616789', 'O 0.158079 2.942276 6.662788', 'O -0.264920 4.710788 5.002527', 'O 2.531469 -3.204159 -4.670074', 'O 1.973550 -1.491599 -7.142431', 'O 4.090584 -1.236041 -5.907860', 'O 4.108314 -2.524515 4.790627', 'O 4.202205 -0.532488 6.237778', 'O 3.779407 1.236820 4.575723', 'O 5.667674 -0.557752 3.552846', 'O 1.645908 2.270664 -7.357585', 'O 1.876020 4.321036 -5.099555', 'O 3.763514 2.525836 -6.123329', 'O 3.874876 3.229085 6.023084', 'O 3.453045 4.998137 4.361973', 'O 5.339685 3.202064 3.338421', 'O -2.977555 0.296777 -1.559122', 'O 4.456533 0.871228 -2.839039', 'H 4.494286 4.142800 6.985531', 'H 5.835464 4.416087 7.435817', 'H -4.434406 6.245600 -7.452941', 'H -5.063366 5.599146 -8.271808', 'H -5.572724 -4.710991 7.298886', 'H -4.720725 -3.851319 7.020072', 'H -5.347257 -5.785340 -7.788752', 'H -4.195068 -6.090961 -7.982523', 'H -4.709432 4.509841 7.541380', 'H -5.668887 4.110591 6.935654', 'H 4.427441 6.126650 -7.403465', 'H 5.114163 5.700085 -8.323100', 'H 4.434988 -5.524427 -7.533479', 'H 3.980998 -4.613728 -6.661589', 'H 5.852568 -5.421991 7.857935', 'H 6.037592 -4.230846 7.956078', 'H -4.389276 0.994880 -9.345367', 'H -5.412228 0.842234 -8.739506', 'H -5.957691 -0.825851 -9.453398', 'H -7.158954 -1.003058 -9.364826', 'H -4.047003 5.479354 -1.474538', 'H -5.094072 4.938772 -1.310798', 'H -5.721845 6.020026 1.312181', 'H -6.685091 5.321124 1.519448', 'H -0.046638 6.077402 -0.831292', 'H -0.917700 6.758360 -1.260512', 'H 1.156808 8.307983 2.060529', 'H 0.045327 8.046471 1.694221', 'H 4.906735 5.481955 -1.250168', 'H 3.897779 4.564116 -1.501499', 'H 5.964734 6.219554 1.286501', 'H 6.524433 5.163075 1.435866', 'H -7.208224 -0.019489 -1.714701', 'H -7.121201 -1.166858 -2.048251', 'H -8.583149 0.938469 1.286919', 'H -7.576340 0.261958 1.027220', 'H -4.618307 -4.668854 -1.464479', 'H -5.813827 -4.792370 -1.721447', 'H -5.234421 -6.697562 1.800764', 'H -5.981343 -5.797345 1.514335', 'H -1.018989 -6.561191 1.949592', 'H -0.031994 -7.183949 1.726632', 'H 0.320709 -7.400076 -1.031755', 'H 0.897963 -8.480355 -1.249976', 'H -6.430465 0.818154 7.218542', 'H -5.329905 0.579018 6.421621', 'H -6.910347 -0.496828 8.765866', 'H -6.077804 -1.079008 9.410404', 'H -0.465211 6.234238 8.545053', 'H -1.270442 5.419555 8.163511', 'H 0.675620 5.412252 10.638374', 'H 1.053710 6.072582 9.665548', 'H 0.703646 4.417637 -5.838887', 'H 0.697883 5.922284 -6.813089', 'H -0.658805 5.798991 -8.881862', 'H -0.814664 7.034581 -9.017541', 'H 6.273480 0.039889 0.867087', 'H 6.861915 1.001366 1.220173', 'H 8.184558 -1.171418 -2.103235', 'H 8.283532 -0.023762 -1.763299', 'H 4.971525 -5.584988 1.645396', 'H 4.096277 -4.635073 1.484255', 'H 5.750884 -5.987233 -1.498348', 'H 6.669734 -5.271942 -1.799547', 'H 5.201658 -0.631554 -8.507208', 'H 6.296094 -1.043397 -8.168259', 'H 5.194365 0.740008 -10.320942', 'H 6.298174 0.986583 -9.823445', 'H -0.581088 -1.365980 -10.352247', 'H -0.973822 -0.237830 -10.471919', 'H 0.271777 0.988119 -11.467150', 'H 1.317340 0.642267 -11.974402', 'H 0.821473 -6.340541 -7.044019', 'H 0.541075 -4.945959 -6.187412', 'H -0.465835 -6.815929 -8.653738', 'H -1.046363 -6.007485 -9.326475', 'H 5.900420 -0.680553 6.422590', 'H 4.648949 -0.212533 5.124180', 'H 6.957938 0.814000 8.671012', 'H 6.117656 0.656287 9.551768', 'H -0.535704 -0.542900 10.887477', 'H -1.158187 -1.112836 10.101316', 'H 1.119943 1.075120 12.249636', 'H 0.605684 0.573817 11.301405', 'H 0.429312 -6.173116 8.343206', 'H 1.320746 -5.392291 8.162916', 'H -1.038531 -5.489204 10.667444', 'H -0.714443 -5.971968 9.616454']

# compound = 'Li4H4-Trial'
# coords = ['Li -1.0043096959 1.0043096959 1.0043096959', 'Li -1.0043096959 -1.0043096959 -1.0043096959', 'Li 1.0043096959 -1.0043096959 1.0043096959', 'Li 1.0043096959 1.0043096959 -1.0043096959', 'H -1.0043096959 -1.0043096959 1.0043096959', 'H -1.0043096959 1.0043096959 -1.0043096959', 'H 1.0043096959 1.0043096959 1.0043096959', 'H 1.0043096959 -1.0043096959 -1.0043096959', 'H -0.5850856992 -1.7543096959 -0.5850856992', 'H -0.0844540981 -1.7543096959 -0.0844540981', 'H 0.0844540981 -2.3793096959 0.0844540981', 'H 0.5850856992 -2.3793096959 0.5850856992', 'H 0.0844540981 -0.0844540981 1.7543096959', 'H 0.5850856992 -0.5850856992 1.7543096959', 'H -0.5850856992 0.5850856992 2.3793096959', 'H -0.0844540981 0.0844540981 2.3793096959', 'H 1.7543096959 -0.5850856992 0.5850856992', 'H 1.7543096959 -0.0844540981 0.0844540981', 'H 2.3793096959 0.0844540981 -0.0844540981', 'H 2.3793096959 0.5850856992 -0.5850856992', 'H -1.7543096959 -0.5850856992 -0.5850856992', 'H -1.7543096959 -0.0844540981 -0.0844540981', 'H -2.3793096959 0.0844540981 0.0844540981', 'H -2.3793096959 0.5850856992 0.5850856992', 'H -0.5850856992 1.7543096959 0.5850856992', 'H -0.0844540981 1.7543096959 0.0844540981', 'H 0.0844540981 2.3793096959 -0.0844540981', 'H 0.5850856992 2.3793096959 -0.5850856992', 'H -0.0844540981 -0.0844540981 -1.7543096959', 'H -0.5850856992 -0.5850856992 -1.7543096959', 'H 0.5850856992 0.5850856992 -2.3793096959', 'H 0.0844540981 0.0844540981 -2.3793096959']
# num_atoms = 8

# energy = calculate_energy(coords)
# print('System energy: ', energy)

# opt_coords = optimise_geometry(coords_2, num_atoms, compound)
# print('Optimised Coordinates: ', opt_coords)

